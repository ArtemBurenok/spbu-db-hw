# spbu-db-hw

В этом репозитории лежат задания, выполненные на курсе "Технологии систем управления базами данных".

Репозиторий будет расширяться по мере выполнения дз.

- [x] ДЗ 1 (CREATE TABLE, Ограничения на поля, Первичные и внешние ключи, INSERT, WHERE, GROUP BY)
- [x] ДЗ 2 (ALTER TABLE, INDEX, JOIN, HAVING, Агрегатные функции)
- [x] ДЗ 3 (CTE, Временные таблицы, EXPLAIN ANALYZE, UNION ALL)
- [ ] ДЗ 4 (Триггеры, транзакции, RAISE)

## Домашнее задание 1

1. Создать таблицу courses, в которой будут храниться курсы студентов.
   В таблице должны быть следуюшие поля:
   * id
   * name
   * is_exam
   * min_grade
   * max_grade
     
2. Создать таблицу groups, в которой будут храниться данные групп. В таблице должны быть следуюшие поля:
   * id
   * full_name
   * short_name
   * students_ids
     
3. Создать таблицу students, в которой будут храниться данные студентов. В таблице должны быть следуюшие поля:
   * id
   * first_name
   * last_name
   * group_id
   * courses_ids
4. Создать таблицу любого курса, в котором будут поля
   * student_id
   * grade
   * grade_str с учетом min_grade и max_grade
   
   Каждую таблицу нужно заполнить соответствующими данные, показать процедуры фильтрации и агрегации.

## Домашнее задание 2

1. Создать промежуточные таблицы:
   * student_courses — связывает студентов с курсами. Поля:
      * id
      * student_id
      * course_id
   * group_courses — связывает группы с курсами. Поля:
      * id
      * group_id
      * course_id
   Заполнить эти таблицы данными, чтобы облегчить работу с отношениями «многие ко многим». Должно гарантироваться уникальное отношение соответствующих полей (ключевое слово UNIQUE).

   Удалить неактуальные, после модификации структуры, поля (пример: courses_ids) SQL запросом, (запрос ALTER TABLE).

2. Добавить в таблицу courses уникальное ограничение на поле name, чтобы не допустить дублирующих названий курсов. Создать индекс на поле group_id в таблице students и объяснить, как индексирование влияет на производительность запросов (Комментариями в коде).

3. Написать запрос, который покажет список всех студентов с их курсами. Найти студентов, у которых средняя оценка по курсам выше, чем у любого другого студента в их группе. (Ключевые слова JOIN, GROUP BY, HAVING)

4. Подсчитать количество студентов на каждом курсе. Найти среднюю оценку на каждом курсе.

## Домашнее задание 3

1. Создайте временную таблицу high_sales_products, которая будет содержать продукты, проданные в количестве более 10 единиц за последние 7 дней. Выведите данные из таблицы high_sales_products 
2. Создайте CTE employee_sales_stats, который посчитает общее количество продаж и среднее количество продаж для каждого сотрудника за последние 30 дней. Напишите запрос, который выводит сотрудников с количеством продаж выше среднего по компании 
3. Используя CTE, создайте иерархическую структуру, показывающую всех сотрудников, которые подчиняются конкретному менеджеру
4. Напишите запрос с CTE, который выведет топ-3 продукта по количеству продаж за текущий месяц и за прошлый месяц. В результатах должно быть указано, к какому месяцу относится каждая запись
5. Создайте индекс для таблицы sales по полю employee_id и sale_date. Проверьте, как наличие индекса влияет на производительность следующего запроса, используя трассировку (EXPLAIN ANALYZE)
6. Используя трассировку, проанализируйте запрос, который находит общее количество проданных единиц каждого продукта. 

## Домашнее задание 4

1. Создать триггеры со всеми возможными ключевыми словами, а также рассмотреть операционные триггеры.
2. Попрактиковаться в созданиях транзакций (привести пример успешной и фейл транзакции, объяснить в комментариях почему она зафейлилась).
3. Попробовать использовать RAISE внутри триггеров для логирования.

